name: '.NET Setup'
description: 'Sets up .NET SDK, caches NuGet packages, restores dependencies and tools'

inputs:
  working-directory:
    description: 'Working directory for dotnet commands'
    required: true
    default: '.'

runs:
  using: 'composite'
  steps:
    - name: Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x

    - name: Mark repo as safe
      run: git config --global --add safe.directory $GITHUB_WORKSPACE
      shell: bash

    - name: Unshallow Git Fetch
      run: git fetch --unshallow
      shell: bash

    - name: Cache NuGet packages
      uses: actions/cache@v4
      with:
        path: ~/.nuget/packages
        key: ${{ runner.os }}-nuget-${{ hashFiles('apps/backend/**/*.?sproj') }}
        restore-keys: |
          ${{ runner.os }}-nuget-

    - name: Restore dependencies
      run: dotnet restore
      working-directory: ${{ inputs.working-directory }}
      shell: bash

    - name: Restore tools
      run: dotnet tool restore
      working-directory: ${{ inputs.working-directory }}
      shell: bash
